<script type="text/javascript">
    RED.nodes.registerType("aws-secret-manager-config", {
        category: "config",
        defaults: {
            name: { value: "" },
            region: { value: "eu-central-1", required: true },
            useIAMRole: { value: false },
            accessKeyId: { value: "" },
            accessKeyIdType: { value: "str" },
            secretAccessKey: { value: "" },
            secretAccessKeyType: { value: "str" }
        },
        credentials: {
            accessKeyId: { type: "text" },
            secretAccessKey: { type: "password" }
        },
        label: function() {
            return this.name || "AWS Secrets Manager Config";
        },
        icon: "font-awesome/fa-key",
        color: "#b2e2b2", // pale green
        oneditprepare: function() {
            // Use only flow, global, str, env for typedInput
            var stdTypes = ['flow','global','str','env'];
            
            // Initialize typedInput for Access Key ID
            $("#node-config-input-accessKeyId").typedInput({
                default: 'str',
                types: stdTypes,
                typeField: "#node-config-input-accessKeyIdType"
            });
            $("#node-config-input-accessKeyId").typedInput('type', this.accessKeyIdType || 'str');
            $("#node-config-input-accessKeyId").typedInput('value', this.accessKeyId || '');

            // Initialize typedInput for Secret Access Key
            $("#node-config-input-secretAccessKey").typedInput({
                default: 'str',
                types: stdTypes,
                typeField: "#node-config-input-secretAccessKeyType"
            });
            $("#node-config-input-secretAccessKey").typedInput('type', this.secretAccessKeyType || 'str');

            // Set the Secret Access Key value
            if (this.secretAccessKey) {
                $("#node-config-input-secretAccessKey").typedInput('value', this.secretAccessKey);
            }

            // Set region value
            if (this.region) {
                $("#node-config-input-region").val(this.region);
            }

            // Set IAM role checkbox
            if (this.useIAMRole) {
                $("#node-config-input-useIAMRole").prop('checked', true);
            }

            // Hide credentials if IAM role is checked
            function updateCredsVisibility() {
                if ($('#node-config-input-useIAMRole').is(':checked')) {
                    $('#node-config-input-accessKeyId').closest('.form-row').hide();
                    $('#node-config-input-secretAccessKey').closest('.form-row').hide();
                } else {
                    $('#node-config-input-accessKeyId').closest('.form-row').show();
                    $('#node-config-input-secretAccessKey').closest('.form-row').show();
                }
            }
            $('#node-config-input-useIAMRole').change(updateCredsVisibility);
            updateCredsVisibility();
        },
        oneditsave: function() {
            // Save the typedInput values
            this.accessKeyIdType = $("#node-config-input-accessKeyIdType").val();
            this.accessKeyId = $("#node-config-input-accessKeyId").typedInput('value');
            this.secretAccessKeyType = $("#node-config-input-secretAccessKeyType").val();
            this.secretAccessKey = $("#node-config-input-secretAccessKey").typedInput('value');
            this.region = $("#node-config-input-region").val();
            this.useIAMRole = $("#node-config-input-useIAMRole").is(':checked');
        }
    });
</script>

<script type="text/x-red" data-template-name="aws-secret-manager-config">
    <div class="form-row">
        <label for="node-config-input-name">
            <i class="fa fa-tag"></i> Name
        </label>
        <input type="text" id="node-config-input-name" placeholder="AWS Secrets Manager Configuration">
    </div>
    <div class="form-row">
        <label for="node-config-input-region">
            <i class="fa fa-globe"></i> Region
        </label>
        <select id="node-config-input-region">
            <option value="us-east-1">US East (N. Virginia)</option>
            <option value="us-east-2">US East (Ohio)</option>
            <option value="us-west-1">US West (N. California)</option>
            <option value="us-west-2">US West (Oregon)</option>
            <option value="af-south-1">Africa (Cape Town)</option>
            <option value="ap-east-1">Asia Pacific (Hong Kong)</option>
            <option value="ap-south-1">Asia Pacific (Mumbai)</option>
            <option value="ap-south-2">Asia Pacific (Hyderabad)</option>
            <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
            <option value="ap-southeast-2">Asia Pacific (Sydney)</option>
            <option value="ap-southeast-3">Asia Pacific (Jakarta)</option>
            <option value="ap-southeast-4">Asia Pacific (Melbourne)</option>
            <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
            <option value="ap-northeast-2">Asia Pacific (Seoul)</option>
            <option value="ap-northeast-3">Asia Pacific (Osaka)</option>
            <option value="ca-central-1">Canada (Central)</option>
            <option value="eu-central-1" selected>EU (Frankfurt)</option>
            <option value="eu-central-2">EU (Zurich)</option>
            <option value="eu-west-1">EU (Ireland)</option>
            <option value="eu-west-2">EU (London)</option>
            <option value="eu-west-3">EU (Paris)</option>
            <option value="eu-north-1">EU (Stockholm)</option>
            <option value="eu-south-1">EU (Milan)</option>
            <option value="eu-south-2">EU (Spain)</option>
            <option value="il-central-1">Israel (Tel Aviv)</option>
            <option value="me-south-1">Middle East (Bahrain)</option>
            <option value="me-central-1">Middle East (UAE)</option>
            <option value="sa-east-1">South America (SÃ£o Paulo)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-useIAMRole">
            <i class="fa fa-user"></i> Use IAM Role
        </label>
        <input type="checkbox" id="node-config-input-useIAMRole">
        <div class="help-text">Use IAM role for authentication (recommended for EC2 instances)</div>
    </div>
    <div class="form-row">
        <label for="node-config-input-accessKeyId">
            <i class="fa fa-key"></i> Access Key ID
        </label>
        <input type="text" id="node-config-input-accessKeyId">
        <input type="hidden" id="node-config-input-accessKeyIdType">
    </div>
    <div class="form-row">
        <label for="node-config-input-secretAccessKey">
            <i class="fa fa-key"></i> Secret Access Key
        </label>
        <input type="password" id="node-config-input-secretAccessKey">
        <input type="hidden" id="node-config-input-secretAccessKeyType">
    </div>
</script>

<script type="text/x-red" data-help-name="aws-secret-manager-config">
    <p>AWS Secrets Manager configuration node that stores AWS credentials.</p>
    <p>You can either:</p>
    <ul>
        <li>Use IAM Role (recommended for EC2 instances)</li>
        <li>Provide credentials directly</li>
        <li>Get credentials from flow context</li>
        <li>Get credentials from global context</li>
        <li>Get credentials from environment variables</li>
    </ul>
    <p><b>Security Note:</b> Credentials are stored securely in Node-RED's credentials store.</p>
    <p><b>Best Practices:</b></p>
    <ul>
        <li>Use IAM roles when possible</li>
        <li>Rotate access keys regularly</li>
        <li>Follow the principle of least privilege</li>
        <li>Use environment variables for sensitive data</li>
    </ul>
</script>

<style>
    .help-text {
        font-size: 0.8em;
        color: #666;
        margin-top: 4px;
    }
</style> 